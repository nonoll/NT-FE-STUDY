# 3부 - 테스트 주도 개발의 패턴

## 테스트 주도 개발 패턴
> 테스트한다는 것은 무엇을 뜻하는가?<br>
> 테스트를 언제 해야 하는가?<br>
> 테스트할 로직을 어떻게 고를 것인가?<br>
> 테스트할 데이터를 어떻게 고를 것인가?

### 격리된 테스트
- 테스트는 전체 애플리케이션을 대상하는 것보다 좀더 작은 스케일로.
- 각각의 테스트는 다른 테스트와 완전히 독립적이어야 한다.

### 테스트 목록
- 시작하기 전에 작성해야 할 테스트 목록을 모두 적어둘 것.
- 현재 작업 범위를 넘어서는 큰 리팩토링 거리를 발견한다면, `다음` 할일 목록으로 옮겨라.
- 제대로 작동하지 않는 테스트를 하나라도 생각할 수 있다면, 그걸 제대로 되게 하는 것이 `코드를 릴리즈`하는 것보다 더 중요하다.
  - 작성한 테스트 코드가 정상 동작할때만 릴리즈하라는 의미

### 테스트 우선
- 테스트 대상이 되는 코드를 작성하기 직전에 작성하는 것이 좋다.
  - 테스트 코드를 작성하면서 소스 코드를 작성하라는 의미

### 단언 우선
- 시스템을 개발할 때 무슨 일부터 하는가?
  - 완료된 시스템이 어떨 거라고 알려주는 이야기부터 작성
- 특정 기능을 개발할 때 무슨 일부터 하는가?
  - 기능이 완료되면 통과할 수 있는 테스트부터 작성
- 테스트를 개발할 때 무슨 일부터 하는가?
  - 완료될 때 통과야해 할 단언부터 작성

### 테스트 데이터
- 테스트할 때 어떤 데이터를 사용해야 하는가?
  - 테스트를 읽을 때 쉽고 따라가기 좋을 만한 데이터를 사용하라.

### 명백한 데이터
- 데이터의 의도를 어떻게 표현할 것인가?
  - 테스트 자체에 예상되는 값과 실제 값을 포함하고 이 둘 사이의 관계를 드러내기 위해 노력 하라.

* * *

## 빨간 막대 패턴
- 이 패턴들은 테스트를 언제 어디에 작성할 것인지, 테스트 작성을 언제 멈출지에 대한 것.

### 한 단계 테스트
- 각 테스트는 최종 목표로 한 단계 진전시켜 줄 수 있어야 한다.

### 시작 테스트
- 어떤 테스트부터 시작하는 게 좋을까? 
  - 오퍼레이션이 아무 일도 하지 않는 경우를 먼저 테스트할 것.

### 설명 테스트

### 학습 테스트

### 또 다른 테스트

### 회귀 테스트

### 휴식

### 다시 하기

* * *

## 테스팅 패턴
- 이 패턴들은 더 상세한 테스트 작성법에 대한 것.

### 자식 테스트
- 지나치게 큰 테스트 케이스를 어떻게 돌아가도록 할 수 있을까?
  - 원래 테스트 케이스의 깨지는 부분에 해당하는 작은 테스트 케이스를 작성 하고.
  - 그 작은 테스트 케이스가 실행되도록 하라.
  - 그 후에 다시 원래의 큰 테스트 케이스를 추가하라.
- 빨강/초록/리팩토링의 리듬을 유지하기 위해

### 모의 객체

### 셀프 션트
- 한 객체가 다른 객체와 올바르게 대화하는지 테스트하려면 어떻게 할까?
  - 테스트 대상이 되는 객체가 원래의 대화 상대가 아니라 테스트 케이스와 대화하도록 만들면 된다.

### 로그 문자열
- 메시지이 호출 순서가 올바른지 검사하려면 어떻게 해야 할까?
  - 로그 문자열을 가지고 있다가 메시지가 호출될 때마다 그 문자열에 추가하도록 한다.

### 크래시 테스트 더미
- 호출되지 않을 것 같은 에러 코드를 어떻게 테스트할 것인가?
  - 실제 작업을 수행하는 대신 그냥 예외를 발생시키기만 하는 특수한 객체를 만들어서 이를 호출한다.
- 객체 전체를 흉내낼 필요가 없다는 점을 제외하면 모의 객체와 유사.

### 깨진 테스트
- `혼자서 프로그래밍할 때` 프로그래밍 세션을 어떤 상태로 끝마치는 게 좋을까?
  - `마지막 테스트가 깨진 상태`로 끝마치는 것이 좋다.
- 이전 작업을 이어갈 수 있는 방법을 의미.
  - 나중에 다시 코딩할 경우, 어느 작업부터 시작할 것인지 인지할 수 있음.

### 깨끗한 체크인
- `팀 프로그래밍을 할 때` 프로그래밍 세션을 어떤 상태로 끝마치는 게 좋을까?
  - `모든 테스트가 성공한 상태`로 끝마치는 것이 좋다.
- 팀 프로젝트에서 프로그래밍 세션을 시작할 경우 자신이 마지막으로 코딩한 다음부터 지금까지 무슨 일이 있었는지 세밀하게 알수 없다.
- 안심이 되고 확신이 있는 상태에서 시작할 필요가 있다.

* * *

## 초로 막대 패턴

### 가짜로 구현하기(진짜로 만들기 전까지만)
- 실패하는 테스트를 만든 후 첫 번째 구현은 어떻게 하는 게 좋을까?
  - 상수를 반환하게 하라.
  - 일단 테스트가 통과하면 단계적으로 상수를 변수를 사용하는 식으로 수식을 변형
- 가짜로 구현하기를 강력하게 만드는 두 가지 효과
  - 심리학적
    - 초록 막대 상태와 빨간 막대 상태에 있는 것은 천지 차이
    - 막대가 초록일때 확신을 갖고 거기부터 리팩토링해 갈 수 있다.
  - 범위(scope) 조절
    - 쓰잘데기 없는 고민으로 때 이르게 혼동하는 일을 예방
    - 다음 케이스를 구현할 때, 이전 테스트의 작동이 보장된다는 것을 알기에 다음 테스트 케이스에도 집중할 수 있다.

### 삼각측량 
- 필자는 어떤 계산을 어떻게 해야 올바르게 추상화할 것인지에 대해 정말 감잡기 어려울 때만 삼각측량을 사용한다고 언급.
  - 예제 코드로만 이해가 됨.. 많이 해봐야 언급하는 맥락을 이해 할 듯..

### 명백한 구현
- 단순한 연산들을 어떻게 구현하는가?
  - 그냥 구현해 버려라.

### 하나에서 여럿으로
- 객체 컬렉션을 다루는 연산은 어떻게 구현하는가?
  - 일단은 컬렉션 없이 구현하고 그 다음에 컬렉션을 사용하게 한다.

* * *

## xUnit 패턴

### 단언
- 테스트가 잘 작동하는지 어떻게 판단할 것인가?
  - boolean 수식을 작성해서 프로그램이 자동으로 코드가 동작하는지에 대한 판단을 수행하도록 하라.

### 픽스처

### 외부 픽스처

### 테스트 메서드

### 예외 테스트

### 전체 테스트

* * *

## 디자인 패턴

- 테스트 주도 개발에서 디자인 패턴의 쓰임새

| 패턴 | 테스트 작성 | 리팩토링 | 요약 |
| --- | :-------: | :-----: | --- |
| 커맨드 | X |  | 계산 작업에 대한 호출을 메시지가 아닌 객체로 표현 |
| 값 객체 | X | | 객체가 생성된 이후 그 값이 절대로 변하지 않게 하여 별칭 문제가 발생하지 않게 한다 |
| 널 객체 | | X | 계산 작업의 기본 사례를 객체로 표현 |
| 템프릿 메서드 | | X | 계산 작업의 변하지 않는 순서를 여러 추상 메서드로 표현. 이 추상 메서드들은 상속을 통해 특별한 작업을 수행하게끔 구체화 |
| 플러거블 객체 | | X | 둘 이상의 구현을 객체를 호출함으로써 다양성을 표현 |
| 플러거블 셀렉터 | | X | 객체별로 서로 다른 메서드가 동적으로 호출되게 함으로써 필요 없는 하위 클래스의 생성을 피한다 |
| 팩토리 메서드 | X | X | 생성자 대신 메서드를 호출함으로써 객체를 생성 |
| 임포스터 | X | X | 현존하는 프로토콜을 갖는 다른 구현을 추가하여 시스템에 변이를 도입 | 
| 컴포지트 | X | X | 하나의 객체로 여러 객체의 행위 조합을 표현 |
| 수집 매개 변수 | X | X | 여러 다른 객체에서 계산한 결과를 모으기 위해 매개 변수를 여러 곳으로 전달 |
* * *

## 리팩토링

### 차이점 일치시키기
- 비슷해 보이는 두 코드 조각을 합치려면 어떻게 해야 할까?
  - 두 코드가 단계적으로 닮아가게끔 수정한다.
  - 이 둘이 완전히 동일해지면 둘을 합친다.

### 변화 격리하기
- 객체나 메서드의 일부만 바꾸려면 어떻게 해야 할까?
  - 일단, 바꿔야 할 부분을 격리한다.

### 데이터 이주시키기
- 표현 양식을 변경하려면 어떻게 해야 할까?
  - 일시적으로 데이터를 중복시킨다.

### 메서드 추출하기
- 길고 복잡한 메서드를 읽기 쉽게 만들려면 어떻게 할까?
  - 긴 메서드의 일부분을 별도의 메서드로 분리해내고 이를 호출하게 한다.

### 메서드 인라인
- 너무 꼬여있거나 산재한 제어 흐름을 단순화하려면 어떻게 할까?
  - 메서드를 호출하는 부분을 호출될 메서드의 본문으로 교체한다.

### 인터페이스 추출하기
- 자바 오퍼레이션에 대한 두 번째 구현을 추가하려면 어떻게 해야 할까?
  - 공통되는 오퍼레이션을 담고 있는 인터페이스를 만들면 된다.

### 메서드 옮기기
- 메서드를 원래 있어야 할 장소로 옮기려면 어떻게 해야 할까?
  - 어울리는 클래스에 메서드를 추가해주고, 그것을 호출하게 하라.

### 메서드 객체
- 여러 개의 매개 변수와 지역 변수를 갖는 복잡한 메서드를 어떻게 표현할까?
  - 메서드를 꺼내서 객체로 만든다.

### 매개 변수 추가

### 메서드 매개 변수를 생성자 매개 변수로 바꾸기

* * *

## TDD 마스터하기

### 단계가 얼마나 커야 하나?

### 테스트할 필요가 없는 것은 무엇인가?
- `"두려움이 지루함으로 변할때까지 테스트를 만들어라"`
- 하지만 이것은 피드백 루프이고 스스로 대답을 찾아야만 한다.

### 좋은 테스트를 갖췄는지의 여부를 어떻게 알 수 있는가?
- 긴 셋업 코드
- 셋업 중복
- 실행 시간이 오래 걸리는 테스트
- 깨지기 쉬운 테스트

### TDD로 프레임워크를 만들려면 어떻게 해야 하나?

### 피드백이 얼마나 필요한가?

### 테스트를 지워야 할 때는 언제인가?
- 서로 겹치는 두 개의 테스트가 있어도 이들을 남겨두어야 하는가?
  - 자신감
    - 테스트를 삭제할 경우 자신감이 줄어들 것 같으면 절대 지우지 말것
  - 커뮤니케이션
    - 두 개의 테스트가 코드의 동일한 부분을 실행하더라도, 이 둘이 서로 다른 시나리오를 말한다면 그대로 유지

### 프로그래밍 언어나 환경이 TDD에 어떤 영향을 주는가?

### 거대한 시스템을 개발할 때에도 TDD를 할 수 있는가?

### 애플리케이션 수준의 테스트로 개발을 주도할 수 있는가?

### 프로젝트 중반에 TDD를 도입하려면 어떻게 해야 할까?

### TDD는 누구를 위한 것인가?

### TDD는 초기 조건에 민감한가?

### TDD와 패턴의 관계는?

### 어째서 TDD가 잘 작동하는가?

### 이름을 테스트 주도 개발이라고 한 이유는?

### TDD와 익스트림 프로그래밍의 실천법 사이에 어떤 관련이 있는가?
